<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <div class="flex h-screen">
      <!-- ì‚¬ì´ë“œë°” -->
      <aside class="w-64 bg-white shadow-md p-6 space-y-6">
        <h2 class="text-xl font-bold">ğŸ‘¤ <span id="adminName">ê´€ë¦¬ì</span></h2>
        <p class="text-sm text-gray-500" id="loginTime">ë¡œê·¸ì¸ ì‹œê°: -</p>
        <nav class="space-y-2">
          <a href="/" class="block text-blue-600 font-medium">ğŸ  í™ˆí˜ì´ì§€</a>
          <span class="block font-semibold text-black">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</span>
          <!-- í–¥í›„ ì¶”ê°€
          <span class="block text-gray-400 pointer-events-none">âš™ï¸ ìš”ì²­ì‚¬í•­ ê´€ë¦¬</span>
          <span class="block text-gray-400 pointer-events-none">ğŸ“ ê²Œì‹œê¸€ ì‘ì„±</span>
          -->
        </nav>
        <div class="absolute bottom-6 left-6 text-sm text-gray-500">
          ê´€ë¦¬ì ì„¼í„°
          <br />
          <span class="text-xs">View profile</span>
        </div>
      </aside>

      <!-- ë©”ì¸ ì½˜í…ì¸  -->
      <main class="flex-1 p-8 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-bold">ì‚¬ìš©ì ëª©ë¡</h1>
          <button
            id="logoutBtn"
            class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
          >
            ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>

        <!-- ì‚¬ìš©ì í…Œì´ë¸” -->
        <div class="overflow-x-auto bg-white shadow-md rounded">
          <table class="w-full table-auto text-sm text-left">
            <thead class="bg-gray-50 font-semibold">
              <tr>
                <th class="px-4 py-3">ID</th>
                <th class="px-4 py-3">ì´ë¦„</th>
                <th class="px-4 py-3">ì´ë©”ì¼</th>
                <th class="px-4 py-3">ë‹‰ë„¤ì„</th>
                <th class="px-4 py-3 text-right">ìš”ì²­ê²Œì‹œê¸€</th>
              </tr>
            </thead>
            <tbody>
              <!-- JSë¡œ ë Œë”ë§ -->
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <script>
      const token = localStorage.getItem('access_token');
      if (!token) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = '/adminlogin.html';
      }

      // ê´€ë¦¬ì ì •ë³´ + ì‚¬ìš©ì ë¡œë”©
      fetch('/admin/me', {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      })
        .then((res) => res.json())
        .then((data) => {
          document.getElementById('adminName').textContent =
            `${data.admin.name} ê´€ë¦¬ì`;
          document.getElementById('loginTime').textContent =
            new Date().toLocaleString();
          loadUsers();
        })
        .catch(() => {
          alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
          localStorage.removeItem('access_token');
          window.location.href = '/adminlogin.html';
        });

      // ì‚¬ìš©ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      async function loadUsers() {
        const res = await fetch('/user', {
          headers: { Authorization: `Bearer ${token}` },
        });
        const users = await res.json();

        const tbody = document.querySelector('tbody');
        tbody.innerHTML = '';
        users.forEach((user, index) => {
          const row = document.createElement('tr');
          row.classList.add('border-b');
          row.innerHTML = `
            <td class="px-4 py-3">${index + 1}</td>
            <td class="px-4 py-3">${user.name}</td>
            <td class="px-4 py-3">${user.email}</td>
            <td class="px-4 py-3">${user.nickname}</td>
            <td class="px-4 py-3 text-right">
              <button class="bg-blue-500 text-white px-3 py-1 rounded">View</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      // ë¡œê·¸ì•„ì›ƒ
      document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('access_token');
        window.location.href = '/adminlogin.html';
      });
    </script>
  </body>
</html>
